<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Visual Snow FAQ</title>
  <style>
    :root{
      --bg:#0c0c0f;
      --bg2:#101016;
      --card:rgba(28,28,36,.85);
      --text:#f3f4f6;
      --muted:#a5a7ae;
      --accent:#4ecdc4;
      --accent-2:#7ad9d2;
      --ring:rgba(78,205,196,.35);
      --shadow:0 10px 30px rgba(0,0,0,.45);
      --radius:14px;
    }

    /* Base */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text);
      background: radial-gradient(1200px 800px at 50% -20%, #1a1a24 0%, var(--bg) 45%, #000 100%);
      display:flex; flex-direction:column; align-items:center;
      overflow-x:hidden; overflow-y:auto;
    }

    /* Header */
    header{
      width:100%;
      position:sticky; top:0; z-index:10;
      backdrop-filter:saturate(120%) blur(6px);
      background:linear-gradient(180deg, rgba(18,18,24,.9), rgba(18,18,24,.4));
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .wrap{max-width:980px; margin:0 auto; padding:12px 16px;}
    .title{display:flex; align-items:center; gap:.75rem}
    .logo{width:28px;height:28px;border-radius:8px;background:radial-gradient(circle at 30% 30%, var(--accent-2), var(--accent)); box-shadow:0 0 30px var(--ring);}
    h1{font-size:clamp(18px,2.5vw,28px); margin:0; letter-spacing:.2px}

    /* Search & Controls */
    .toolbar{display:flex; flex-wrap:wrap; gap:.6rem; margin-top:10px; align-items:center}
    #search{flex:1 1 280px; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.08); background:#14141b; color:var(--text); outline:none}
    #search:focus{border-color:var(--accent); box-shadow:0 0 0 3px var(--ring)}
    .btn{padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#14141b; color:var(--text); cursor:pointer}
    .btn:hover{border-color:rgba(255,255,255,.18)}

    /* Book */
    .stage{display:flex; flex-direction:column; align-items:center; gap:10px; padding:18px 12px 24px}
    .book{width:min(92vw,540px); height:64vh; min-height:420px; perspective:2000px; position:relative}

    .page{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      position:absolute; inset:0; padding:18px 18px 24px 18px;
      border:1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(6px) saturate(110%);
      transform-origin:left; backface-visibility:hidden;
      transition: transform 1s cubic-bezier(.22,.61,.36,1), box-shadow .6s ease, opacity .6s ease;
      overflow:auto;
    }
    .page h2{font-size:clamp(16px,2.2vw,22px); margin:0 0 .6rem}
    .page p{line-height:1.55; color:#d7dae0; margin:0}
    .flipped{ transform: rotateY(-180deg); box-shadow:-8px 0 22px rgba(0,0,0,.35)}

    /* Index */
    #pageIndex{ display:flex; flex-wrap:wrap; gap:.4rem; justify-content:center; max-width:960px; padding:0 12px 14px}
    #pageIndex button{padding:.45rem .65rem; font-size:.85rem; border-radius:10px; background:#12121a; color:#e9e9ee; border:1px solid rgba(255,255,255,.08); cursor:pointer}
    #pageIndex button:hover{border-color:rgba(255,255,255,.18)}

    /* Controls */
    .controls{display:flex; align-items:center; gap:.6rem}
    .icon-btn{width:40px; height:40px; display:grid; place-items:center; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#14141b; cursor:pointer}
    .icon-btn:hover{border-color:rgba(255,255,255,.18)}
    .pill{font-size:.9rem; color:var(--muted)}
    .accent{color:var(--accent)}

    /* Wisps */
    .wisp{ position:fixed; pointer-events:none; z-index:0; background: radial-gradient(circle, rgba(255,255,255,.08) 0%, transparent 70%); border-radius:50%; animation:float 18s infinite ease-in-out;}
    @keyframes float{0%{transform:translateY(80vh) scale(.25); opacity:0}50%{opacity:.25}100%{transform:translateY(-20vh) scale(1); opacity:0}}

    /* Progress Bar */
    .progress{height:6px; width:100%; background:rgba(255,255,255,.06); border-radius:999px; overflow:hidden}
    .progress > span{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent), var(--accent-2));}

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      .wisp{display:none}
      .page{transition:none}
    }

    /* Small screens */
    @media (max-width:420px){
      .book{height:62vh; min-height:380px}
      #pageIndex{display:none}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">
        <div class="logo" aria-hidden="true"></div>
        <h1>Visual Snow FAQ</h1>
      </div>
      <div class="toolbar" role="region" aria-label="Search and controls">
        <input id="search" type="text" placeholder="Search FAQ‚Ä¶ (e.g., photophobia)" aria-label="Search FAQs" />
        <button class="btn" id="toggle-sound" aria-pressed="true" aria-label="Toggle page flip sound">üîä Sound</button>
        <div class="pill" id="page-pill">Page <span class="accent" id="pageNow">1</span>/<span id="pageTotal">1</span></div>
      </div>
      <div class="progress"><span id="progressFill"></span></div>
    </div>
  </header>

  <main class="stage">
    <div class="controls" aria-label="Page navigation">
      <button class="icon-btn" id="prevBtn" title="Previous (‚Üê)" aria-label="Previous page">‚üµ</button>
      <div class="book" id="book" aria-live="polite"></div>
      <button class="icon-btn" id="nextBtn" title="Next (‚Üí)" aria-label="Next page">‚ü∂</button>
    </div>
  </main>

  <section id="pageIndex" aria-label="Quick index"></section>

  <footer class="wrap" style="opacity:.9; padding-bottom:48px">
    <p style="margin:.6rem 0 0; font-size:.9rem; color:var(--muted)">‚ù§Ô∏è Support Visual Snow research: <a href="https://visualsnowcommunity.github.io/VisualSnowCommunity/" target="_blank" style="color:var(--accent)">Donate here</a></p>
  </footer>

  <audio id="flipSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_b84c1ef649.mp3?filename=page-flip-8-141481.mp3"></audio>

  <script>
    // ===== Data (use your existing array or the updated one) =====
    const faqs = [
      { q: "What is Visual Snow?", a: "Visual snow is a neurological condition characterized by seeing static or 'snow' in the visual field, similar to television static, which persists even with closed eyes." },
      { q: "What does Visual Snow look like?", a: "Individuals report seeing small, flickering dots across their entire visual field, usually black and white or transparent." },
      { q: "Is Visual Snow related to other eye or brain disorders?", a: "It may co-occur with migraines or tinnitus, but is considered a distinct condition." },
      { q: "How common is Visual Snow?", a: "It's relatively rare, more frequent in those with migraine or aura symptoms." },
      { q: "What causes Visual Snow?", a: "The exact cause is unknown, but research points to hyperactivity in visual processing areas like the thalamus and cortex." },
      { q: "What are common symptoms of Visual Snow?", a: "Static vision, light sensitivity, afterimages, poor night vision, and color flashes." },
      { q: "What is the Blue Field Entoptic Phenomenon?", a: "Seeing small bright dots against blue sky - common in visual snow." },
      { q: "Can Visual Snow cause blindness?", a: "No, it affects perception, not physical vision." },
      { q: "Is there a cure for Visual Snow?", a: "No cure currently, but symptom management is possible." },
      { q: "What treatments are available?", a: "Migraine/anxiety meds, vision therapy, and lifestyle changes help some individuals." },
      { q: "Does medication help?", a: "Some find relief with certain medications, but responses vary." },
      { q: "Are lifestyle changes helpful?", a: "Yes. Sleep, stress reduction, and light management help some cope." },
      { q: "What is photophobia?", a: "Light sensitivity that can worsen visual snow symptoms." },
      { q: "Does caffeine worsen it?", a: "Some report increased symptoms, varies by person." },
      { q: "Are visual exercises helpful?", a: "Some vision therapy may ease symptoms like light sensitivity." },
      { q: "How does it affect night vision?", a: "It often worsens night vision due to static and sensitivity." },
      { q: "Is Visual Snow progressive?", a: "Not usually, but stress can heighten awareness of symptoms." },
      { q: "Can it go away on its own?", a: "Symptoms may lessen, but often persist long-term." },
      { q: "Is Visual Snow genetic?", a: "No clear link, though a predisposition may exist." },
      { q: "Does it only affect vision?", a: "Primarily visual, but may include tinnitus or dizziness." },
      { q: "How is it diagnosed?", a: "Clinical evaluation - no specific test exists." },
      { q: "Do visual aids help?", a: "Tinted lenses may reduce discomfort for some." },
      { q: "Does screen time worsen it?", a: "Yes, for some. Breaks and brightness adjustment help." },
      { q: "Is it a type of aura?", a: "No, but it can co-occur with migraine aura." },
      { q: "What research exists?", a: "Focus on brain imaging, symptoms, and treatments." },
      { q: "Are support groups available?", a: "Yes, online communities offer help and connection." },
      { q: "Is it caused by stress or anxiety?", a: "Not directly, but both can exacerbate symptoms." },
      { q: "How does it impact daily life?", a: "It may affect reading, driving, and work, but coping strategies help." },
      { q: "Can I drive with it?", a: "Many can, though night driving may be difficult." },
      { q: "Does it affect everyone the same way?", a: "No. Severity and symptoms vary widely." },
      { q: "How to explain it to others?", a: "Compare it to TV static overlaying your vision." },
      { q: "Alternative treatments?", a: "Some try acupuncture, supplements, or mindfulness - with mixed results." },
      { q: "What to avoid?", a: "Bright lights, high-contrast screens, and stress may worsen symptoms." },
      { q: "Can I wear contacts?", a: "Yes. Tinted glasses may be preferred for light filtering." },
      { q: "Is it linked to medications?", a: "Rarely, some nervous system drugs might trigger it." },
      { q: "Does it affect depth perception?", a: "It can interfere slightly due to constant visual noise." },
      { q: "Can it cause eye pain?", a: "No, but eye strain may occur from light sensitivity." },
      { q: "Mental health impact?", a: "Yes. It can lead to anxiety or depression. Support helps." },
      { q: "Is it medically recognized?", a: "Yes, increasingly acknowledged by neurology experts." },
      { q: "Other sensory issues?", a: "Some report tinnitus or mild disturbances." },
      { q: "What if it worsens?", a: "Consult a doctor to reassess and manage symptoms." }
    ];

    // ===== Elements =====
    const book = document.getElementById('book');
    const pageIndex = document.getElementById('pageIndex');
    const flipSound = document.getElementById('flipSound');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const searchInput = document.getElementById('search');
    const pageNow = document.getElementById('pageNow');
    const pageTotal = document.getElementById('pageTotal');
    const progressFill = document.getElementById('progressFill');
    const soundBtn = document.getElementById('toggle-sound');

    let currentPage = 0;
    let soundOn = true;
    let filtered = [...faqs];

    // ===== Render =====
    function highlight(text, term){
      if(!term) return text;
      const esc = term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
      return text.replace(new RegExp(`(${esc})`,'gi'), '<mark style="background: rgba(78,205,196,.25); color: inherit; padding: 0 .15em; border-radius: 4px;">$1</mark>');
    }

    function renderPages(){
      book.innerHTML = '';
      pageIndex.innerHTML = '';
      filtered.forEach((item,i)=>{
        const page = document.createElement('div');
        page.className = 'page';
        page.style.zIndex = filtered.length - i;
        const term = searchInput.value.trim();
        page.innerHTML = `<h2>${highlight(item.q, term)}</h2><p>${highlight(item.a, term)}</p>`;
        book.appendChild(page);

        const idx = document.createElement('button');
        idx.textContent = `${i+1}. ${item.q}`;
        idx.addEventListener('click',()=>{ currentPage = i; updateFlip(true); play(); });
        pageIndex.appendChild(idx);
      });
      updateFlip(false);
      updateMeta();
    }

    function updateFlip(withFocus){
      const pages = book.querySelectorAll('.page');
      pages.forEach((p,i)=>{ p.classList.toggle('flipped', i < currentPage); });
      if(withFocus){
        const pg = pages[currentPage];
        if(pg) pg.focus?.();
      }
      updateMeta();
    }

    function updateMeta(){
      pageNow.textContent = Math.min(currentPage+1, Math.max(filtered.length,1));
      pageTotal.textContent = filtered.length;
      const pct = filtered.length ? ((currentPage+1)/filtered.length)*100 : 0;
      progressFill.style.width = pct + '%';
    }

    function nextPage(){ if(currentPage < filtered.length){ currentPage++; updateFlip(true); play(); } }
    function prevPage(){ if(currentPage > 0){ currentPage--; updateFlip(true); play(); } }
    function play(){ if(soundOn) flipSound.currentTime = 0, flipSound.play(); }

    // ===== Events =====
    prevBtn.addEventListener('click', prevPage);
    nextBtn.addEventListener('click', nextPage);

    document.addEventListener('keydown', e=>{
      if(e.key==='ArrowRight') nextPage();
      if(e.key==='ArrowLeft') prevPage();
    });

    let touchStartX = 0;
    book.addEventListener('touchstart', e=>{ touchStartX = e.touches[0].clientX; }, {passive:true});
    book.addEventListener('touchend', e=>{
      const x = e.changedTouches[0].clientX;
      if(x < touchStartX - 40) nextPage();
      else if(x > touchStartX + 40) prevPage();
    });

    searchInput.addEventListener('input', ()=>{
      const term = searchInput.value.toLowerCase();
      filtered = faqs.filter(f=> f.q.toLowerCase().includes(term) || f.a.toLowerCase().includes(term));
      currentPage = 0; renderPages();
    });

    soundBtn.addEventListener('click', ()=>{
      soundOn = !soundOn;
      soundBtn.textContent = soundOn ? 'üîä Sound' : 'üîá Sound';
      soundBtn.setAttribute('aria-pressed', String(soundOn));
    });

    // ===== Wisps =====
    function spawnWisps(n){
      for(let i=0;i<n;i++){
        const d=document.createElement('div');
        d.className='wisp';
        const sz = Math.random()*26+10; d.style.width=sz+'px'; d.style.height=sz+'px';
        d.style.left=Math.random()*100+'%'; d.style.top=Math.random()*100+'%';
        d.style.animationDuration = (14 + Math.random()*10) + 's';
        document.body.appendChild(d);
      }
    }

    // Init
    spawnWisps(20);
    renderPages();
  </script>
</body>
</html>
